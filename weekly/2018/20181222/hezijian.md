# 20181222

又是周六...

这周干了一个微小的工作 -- 沙箱. 说是沙箱其实也不太准确, 但就这么称呼好啦~~

这周还上了操作系统的课程设计, 没弄难的, 就跑回实验室调沙箱代码.

遇到的坑:
- GDB 默认只会监控主进程, 所以fork出来的子进程是监控不到的...后来知道可以加参数, 但是 Clion 不支持加参数.
- sleep(2)...我以为我的代码写的有多差, 沙箱启动到退出要2s..后来才发现自己写了个sleep..为了解决上面那个问题, 延迟代码执行
- fileno(nullptr) 是报SEGV的, 也是犯蠢... 主线程收到的子线程信号一直是SIGSEVG, 才发现是这个问题, 按道理应该是SIGUSR2..
- 还有各种犯蠢, 类似的代码复制后没改值啊之类的...
- 还有 setrlimit 内存限制, 太严格了, 如果程序企图申请一个超过限制的内存, 会直接被SIGSEVG掉. 只能写个..killer去看着..

反正到今天为止, 除了systemcall还没处理, 大部分限制都可以使用